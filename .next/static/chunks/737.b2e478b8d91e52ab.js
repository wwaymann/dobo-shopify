"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[737],{737:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var l=n(7876),o=n(4232),r=n(6162),i=n(8477);class a{push(e){var t;this.stack=this.stack.slice(0,this.index+1),this.stack.push(e),this.stack.length>this.limit&&this.stack.shift(),this.index=this.stack.length-1,null==(t=this.onChange)||t.call(this,this.stack[this.index])}undo(){var e;if(!this.canUndo())return null;this.index-=1;let t=this.stack[this.index];return null==(e=this.onChange)||e.call(this,t),t}redo(){var e;if(!this.canRedo())return null;this.index+=1;let t=this.stack[this.index];return null==(e=this.onChange)||e.call(this,t),t}canUndo(){return this.index>0}canRedo(){return this.index>=0&&this.index<this.stack.length-1}constructor({limit:e=200,onChange:t}={}){this.stack=[],this.index=-1,this.limit=e,this.onChange=t}}let s=[{name:"Arial",css:"Arial, Helvetica, sans-serif"},{name:"Georgia",css:"Georgia, serif"},{name:"Times New Roman",css:'"Times New Roman", Times, serif'},{name:"Courier New",css:'"Courier New", Courier, monospace'},{name:"Trebuchet MS",css:'"Trebuchet MS", Tahoma, sans-serif'},{name:"Montserrat",css:"Montserrat, Arial, sans-serif"},{name:"Poppins",css:"Poppins, Arial, sans-serif"}],c=(e,t,n)=>Math.max(t,Math.min(n,e));function u(e){let t=String(e||"").replace("#","").match(/^([0-9a-f]{3}|[0-9a-f]{6})$/i);if(!t)return[51,51,51];let n=t[1];3===n.length&&(n=n.split("").map(e=>e+e).join(""));let l=parseInt(n,16);return[l>>16&255,l>>8&255,255&l]}function d(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{maxDim:l=500,makeDark:o=!0,drawColor:i=[51,51,51],thrBias:a=0}=n,s=null==e?void 0:e.width,u=null==e?void 0:e.height;if(!s||!u)return null;let d=s>u?l/s:l/u,p=Math.max(1,Math.round(s*d)),g=Math.max(1,Math.round(u*d)),h=document.createElement("canvas");h.width=p,h.height=g;let f=h.getContext("2d",{willReadFrequently:!0});f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",f.drawImage(e,0,0,p,g);try{t=f.getImageData(0,0,p,g)}catch(e){return null}let m=null==t?void 0:t.data,b=p*g;if(!m||m.length<4*b)return null;let v=new Uint8Array(b);for(let e=0,t=0;t<b;e+=4,t++){let n=m[e],l=m[e+1],o=m[e+2];v[t]=Math.round(.299*n+.587*l+.114*o)}let x=c(function(e,t){if(!e||!t||t<=0)return 127;let n=new Uint32Array(256);for(let l=0;l<t;l++)n[e[l]]++;let l=0;for(let e=0;e<256;e++)l+=e*n[e];let o=0,r=0,i=-1,a=127;for(let e=0;e<256;e++){if(0===(r+=n[e]))continue;let s=t-r;if(0===s)break;let c=(o+=e*n[e])/r-(l-o)/s,u=r*s*c*c;Number.isFinite(u)&&u>i&&(i=u,a=e)}return a}(v,b)+a,0,255);for(let e=0,t=0;e<b;e++,t+=4)(o?v[e]<=x:v[e]>x)?(m[t]=i[0],m[t+1]=i[1],m[t+2]=i[2],m[t+3]=255):m[t+3]=0;f.putImageData(t,0,0);let y=new r.Image(h,{left:0,top:0,originX:"left",originY:"top",objectCaching:!1,noScaleCache:!0,selectable:!0,evented:!0});return y._vecSourceEl=e,y._vecMeta={w:p,h:g},y._doboKind="vector",y}function p(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=new r.Textbox(e,{...n,originX:"center",originY:"center",selectable:!0,evented:!0,objectCaching:!1,fill:null!=(t=n.fill)?t:"rgba(35,35,35,1)"}),o=new r.Textbox(e,{...n,originX:"center",originY:"center",left:-1,top:-1,selectable:!1,evented:!1,objectCaching:!1,fill:"",stroke:"rgba(0,0,0,0.25)",strokeWidth:.8}),i=new r.Textbox(e,{...n,originX:"center",originY:"center",left:1,top:1,selectable:!1,evented:!1,objectCaching:!1,fill:"",stroke:"rgba(255,255,255,0.45)",strokeWidth:.5}),a=new r.Group([o,i,l],{originX:"center",originY:"center",subTargetCheck:!1,objectCaching:!1,selectable:!0,evented:!0,scaleX:1,scaleY:1});a._kind="textGroup",a._textChildren={base:l,shadow:o,highlight:i};let s=()=>{var e,t;let n=Math.max(1e-6,Math.abs(a.scaleX||1)),l=Math.max(1e-6,Math.abs(a.scaleY||1)),r=1/n,s=1/l;o.set({left:-r,top:-s}),i.set({left:+r,top:+s}),a.setCoords(),null==(t=a.canvas)||null==(e=t.requestRenderAll)||e.call(t)};return a.on("scaling",s),a.on("modified",s),s(),a}function g(e){let t,{stageRef:n,anchorRef:g,visible:h=!0,zoom:f=.6,setZoom:m}=e,b=(0,o.useRef)(null),v=(0,o.useRef)(null),x=(0,o.useRef)(null),y=(0,o.useRef)(null),j=(0,o.useRef)(null),w=(0,o.useRef)(null),C=(0,o.useRef)(null),[k,A]=(0,o.useState)(null),[P,S]=(0,o.useState)({w:1,h:1}),[N,E]=(0,o.useState)({left:0,top:0,w:1,h:1}),[D,_]=(0,o.useState)(!1),[O,R]=(0,o.useState)(!1),[M,T]=(0,o.useState)("none"),F=(0,o.useRef)(null),[W,Y]=(0,o.useState)({canUndo:!1,canRedo:!1}),[X,q]=(0,o.useState)(s[0].css),[I,G]=(0,o.useState)(60),[B,z]=(0,o.useState)(!1),[H,L]=(0,o.useState)(!1),[U,K]=(0,o.useState)(!1),[J,V]=(0,o.useState)("center"),[Z,Q]=(0,o.useState)(!1),[$,ee]=(0,o.useState)(!1),[et,en]=(0,o.useState)("#333333"),[el,eo]=(0,o.useState)(0),er=(0,o.useRef)(!1),ei=(0,o.useRef)(null),ea=()=>{let e=v.current;return e?e.toJSON(["_kind","_textChildren","_vecSourceEl","_vecMeta","_doboKind"]):null},es=e=>{let t=v.current;t&&e&&(t._skipHistory=!0,t.loadFromJSON(e,()=>{t._skipHistory=!1,t.requestRenderAll()}))},ec=()=>{var e,t;return Y({canUndo:!!(null==(e=F.current)?void 0:e.canUndo()),canRedo:!!(null==(t=F.current)?void 0:t.canRedo())})},eu=(t=null,()=>{var e;null!=(e=v.current)&&e._skipHistory||(clearTimeout(t),t=setTimeout(()=>{let e=ea();e&&F.current&&F.current.push(e),ec()},140))});(0,o.useLayoutEffect)(()=>{let e=null==g?void 0:g.current;if(!e)return;let t=e.style.position;return"static"===getComputedStyle(e).position&&(e.style.position="relative"),()=>{try{e.style.position=t}catch(e){}}},[g]),(0,o.useLayoutEffect)(()=>{let e=null==n?void 0:n.current,t=null==g?void 0:g.current;if(!e||!t)return;let l=()=>{let n=Math.max(1,t.clientWidth),l=Math.max(1,t.clientHeight),o=0,r=0,i=t;for(;i&&i!==e;)o+=i.offsetLeft||0,r+=i.offsetTop||0,i=i.offsetParent;S({w:n,h:l}),E({left:o,top:r,w:n,h:l});let a=v.current;if(a){var s,c;a.setWidth(n),a.setHeight(l),null==(s=a.calcOffset)||s.call(a),null==(c=a.requestRenderAll)||c.call(a)}};l();let o=new ResizeObserver(l),r=new ResizeObserver(l);try{o.observe(t)}catch(e){}try{r.observe(e)}catch(e){}return window.addEventListener("resize",l,{passive:!0}),()=>{try{o.disconnect()}catch(e){}try{r.disconnect()}catch(e){}window.removeEventListener("resize",l)}},[n,g]),(0,o.useEffect)(()=>{var e;let t="number"==typeof f?f:.6;null==n||null==(e=n.current)||e.style.setProperty("--zoom",String(t))},[f,n]),(0,o.useEffect)(()=>{if(!h||!b.current||v.current)return;let e=new r.Canvas(b.current,{width:1,height:1,preserveObjectStacking:!0,selection:!0,perPixelTargetFind:!0,targetFindTolerance:8});v.current=e,(()=>{var e;let t=v.current;if(!t)return;t.upperCanvasEl&&(t.upperCanvasEl.setAttribute("tabindex","0"),t.upperCanvasEl.style.touchAction="none",t.upperCanvasEl.addEventListener("touchstart",()=>t.upperCanvasEl.focus(),{passive:!1})),t.perPixelTargetFind=!1,t.targetFindTolerance=12,(null==r||null==(e=r.Object)?void 0:e.prototype)&&(r.Object.prototype.padding=8);let n=e=>!!e&&("textbox"===e.type||"i-text"===e.type||"textGroup"===e._kind),l=e=>{n(e)&&requestAnimationFrame(()=>{if("textbox"===e.type||"i-text"===e.type){var n,l,o;e.selectable=!0,e.editable=!0,e.evented=!0,t.setActiveObject(e),null==(n=e.enterEditing)||n.call(e),null==(o=e.hiddenTextarea)||null==(l=o.focus)||l.call(o)}else"textGroup"===e._kind&&"function"==typeof ed&&(ed(e),t.setActiveObject(e));t.requestRenderAll()})},o=null,i=!1,a=0;t.on("mouse:down",e=>{var t,n,l,r;let a=performance.now();i=!1,o={x:null!=(l=null==(t=e.pointer)?void 0:t.x)?l:0,y:null!=(r=null==(n=e.pointer)?void 0:n.y)?r:0,t:a,target:e.target||null}}),t.on("mouse:move",e=>{let t,n;if(!o)return;let l=e.pointer||{x:0,y:0};t={x:l.x,y:l.y},n={x:o.x,y:o.y},Math.hypot(t.x-n.x,t.y-n.y)>6&&(i=!0)}),t.on("mouse:up",e=>{let t=performance.now();if(!o)return;let r=o.target,s=t-o.t;if(t<a){o=null;return}if(!i&&s<=220&&n(r)){var c,u,d,p;null==(u=e.e)||null==(c=u.preventDefault)||c.call(u),null==(p=e.e)||null==(d=p.stopPropagation)||d.call(p),l(r),a=t+300}o=null}),t.on("mouse:dblclick",e=>{var t,o,r,i;let s=performance.now(),c=e.target;n(c)&&(s<a||(null==(o=e.e)||null==(t=o.preventDefault)||t.call(o),null==(i=e.e)||null==(r=i.stopPropagation)||r.call(i),l(c),a=s+300))}),t.on("text:editing:exited",e=>{let n=null==e?void 0:e.target;n&&(n.editable=!0,n.selectable=!0,n.evented=!0,n.hasControls=!0,n.lockMovementX=!1,n.lockMovementY=!1,t.setActiveObject(n),t.requestRenderAll())})})();let t=e=>{let{x:t,y:n,w:l,h:o}=e;ei.current={x:t,y:n,w:l,h:o}};t({x:10,y:10,w:e.getWidth()-20,h:e.getHeight()-20});let n=e=>{let t=ei.current;if(!t||!e)return;e.setCoords();let n=e.getBoundingRect(!0),l=0,o=0;if(n.left<t.x&&(l=t.x-n.left),n.top<t.y&&(o=t.y-n.top),n.left+n.width>t.x+t.w&&(l=t.x+t.w-(n.left+n.width)),n.top+n.height>t.y+t.h&&(o=t.y+t.h-(n.top+n.height)),l||o){var r,i;e.left=(null!=(r=e.left)?r:0)+l,e.top=(null!=(i=e.top)?i:0)+o,e.setCoords()}},l=e=>n(e.target),o=e=>n(e.target),i=e=>n(e.target),c=e=>n(e.target);e.on("object:moving",l),e.on("object:scaling",o),e.on("object:rotating",i),e.on("object:added",c);let u=new ResizeObserver(()=>{t({x:10,y:10,w:e.getWidth()-20,h:e.getHeight()-20});let l=e.getActiveObject();l&&n(l)});u.observe(e.upperCanvasEl),F.current=new a({limit:200,onChange:ec}),e.once("after:render",()=>{let e=ea();e&&F.current.push(e),ec()});let d=()=>eu(),p=()=>eu(),g=()=>eu(),f=()=>eu();e.on("object:added",d),e.on("object:modified",p),e.on("object:removed",g),e.on("path:created",f);let m=e=>e&&("i-text"===e.type||"textbox"===e.type||"text"===e.type),x=()=>{let t=e.getActiveObject();if(er.current){try{(null==t?void 0:t.type)==="activeSelection"&&t.discard()}catch(e){}try{e.discardActiveObject()}catch(e){}try{e.setActiveObject(null)}catch(e){}try{e._activeObject=null}catch(e){}T("none"),e.requestRenderAll();return}T(t?"textGroup"===t._kind?"text":"vector"===t._doboKind||"image"===t.type?"image":"i-text"===t.type||"textbox"===t.type||"text"===t.type?"text":"none":"none"),(()=>{var t,n,l,o;let r=e.getActiveObject();if(!r)return;let i=null;"textGroup"===r._kind?i=(null==(t=r._textChildren)?void 0:t.base)||null:"activeSelection"===r.type?i=(null==(o=r._objects)||null==(l=o.find(e=>"textGroup"===e._kind))||null==(n=l._textChildren)?void 0:n.base)||null:m(r)&&(i=r),i&&(q(i.fontFamily||s[0].css),G(i.fontSize||60),z(i.fontWeight+""=="700"||"bold"===i.fontWeight),L(i.fontStyle+""=="italic"),K(!!i.underline),V(i.textAlign||"center"))})()};e.on("selection:created",x),e.on("selection:updated",x),e.on("selection:cleared",()=>T("none")),e.on("mouse:dblclick",t=>{let n=t.target;n&&("textGroup"===n._kind?ed(n):m(n)&&"function"==typeof n.enterEditing&&(n.enterEditing(),e.requestRenderAll()))}),R(!0);{let t={toPNG:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;return e.toDataURL({format:"png",multiplier:t,backgroundColor:"transparent"})},toSVG:()=>e.toSVG({suppressPreamble:!0}),getCanvas:()=>e,exportDesignSnapshot:()=>{try{return e.toJSON()}catch(e){return null}},importDesignSnapshot:t=>new Promise(n=>{try{e.loadFromJSON(t,()=>{e.requestRenderAll(),n(!0)})}catch(e){n(!1)}}),reset:()=>{try{e.clear(),e.requestRenderAll()}catch(e){}}};window.doboDesignAPI=t;try{window.dispatchEvent(new CustomEvent("dobo:ready",{detail:t})),console.log("[DOBO] API global inicializada ✅")}catch(e){}}return()=>{e.off("mouse:dblclick"),e.off("selection:created",x),e.off("selection:updated",x),e.off("selection:cleared"),e.off("object:added",d),e.off("object:modified",p),e.off("object:removed",g),e.off("path:created",f),e.off("object:moving",l),e.off("object:scaling",o),e.off("object:rotating",i),e.off("object:added",c);try{u.disconnect()}catch(e){}try{e.dispose()}catch(e){}v.current=null}},[h]),(0,o.useEffect)(()=>{var e,t;let n=v.current;n&&(n.setWidth(P.w),n.setHeight(P.h),null==(e=n.calcOffset)||e.call(n),null==(t=n.requestRenderAll)||t.call(n))},[P.w,P.h]),(0,o.useEffect)(()=>{let e=v.current;if(!e)return;let t=(e,n)=>{if(!e)return;let l="textGroup"===e._kind;if(e.selectable=n,e.evented=n,e.lockMovementX=!n,e.lockMovementY=!n,e.hasControls=n,e.hasBorders=n,l||"i-text"!==e.type&&"function"!=typeof e.enterEditing||(e.editable=n),e.hoverCursor=n?"move":"default",l)return;let o=e._objects||("function"==typeof e.getObjects?e.getObjects():null);Array.isArray(o)&&o.forEach(e=>t(e,n))};(n=>{var l,o,r;e.skipTargetFind=!n,e.selection=n,((null==(l=e.getObjects)?void 0:l.call(e))||[]).forEach(e=>t(e,n));let i=e.upperCanvasEl;i&&(i.style.pointerEvents=n?"auto":"none",i.style.touchAction=n?"none":"auto",i.tabIndex=n?0:-1),e.defaultCursor=n?"move":"default";try{e.discardActiveObject()}catch(e){}null==(o=e.calcOffset)||o.call(e),null==(r=e.requestRenderAll)||r.call(e),setTimeout(()=>{var t,n;null==(t=e.calcOffset)||t.call(e),null==(n=e.requestRenderAll)||n.call(e)},0)})(!!D)},[D]);let ed=e=>{var t;let n=v.current;if(!n||!e||"textGroup"!==e._kind)return;let l=null==(t=e._textChildren)?void 0:t.base;if(!l)return;let o={left:e.left,top:e.top,originX:"center",originY:"center",scaleX:e.scaleX||1,scaleY:e.scaleY||1,angle:e.angle||0};try{n.remove(e)}catch(e){}let i=new r.Textbox(l.text||"Texto",{left:o.left,top:o.top,originX:"center",originY:"center",width:Math.min(.9*P.w,l.width||240),fontFamily:l.fontFamily,fontSize:l.fontSize,fontWeight:l.fontWeight,fontStyle:l.fontStyle,underline:l.underline,textAlign:l.textAlign,editable:!0,selectable:!0,evented:!0,objectCaching:!1,fill:l.fill||"rgba(35,35,35,1)"});n.add(i),n.setActiveObject(i),n.requestRenderAll(),Q(!0),setTimeout(()=>{var e,t;try{null==(e=i.enterEditing)||e.call(i)}catch(e){}try{null==(t=i.hiddenTextarea)||t.focus()}catch(e){}setTimeout(()=>{try{var e;null==(e=i.hiddenTextarea)||e.focus()}catch(e){}},60)},0);let a=()=>{let e=i.text||"",t={left:i.left,top:i.top,originX:i.originX,originY:i.originY,scaleX:i.scaleX,scaleY:i.scaleY,angle:i.angle};try{n.remove(i)}catch(e){}let l=p(e,{width:i.width,fontFamily:i.fontFamily,fontSize:i.fontSize,fontWeight:i.fontWeight,fontStyle:i.fontStyle,underline:i.underline,textAlign:i.textAlign,fill:i.fill});l.set(t),n.add(l),n.setActiveObject(l),n.requestRenderAll(),T("text"),Q(!1)},s=()=>{i.off("editing:exited",s),a()};i.on("editing:exited",s);let c=setTimeout(()=>{try{i.off("editing:exited",s)}catch(e){}a()},15e3);i.on("removed",()=>{clearTimeout(c)})},ep=()=>{let e=v.current;if(!e)return;let t=p("Nuevo texto",{width:Math.min(.9*P.w,240),fontSize:I,fontFamily:X,fontWeight:B?"700":"normal",fontStyle:H?"italic":"normal",underline:U,textAlign:J,fill:"rgba(".concat(u(et).join(","),",1)")});t.set({left:P.w/2,top:P.h/2,originX:"center",originY:"center"});let n=e.add(t);return e.setActiveObject(t),T("text"),e.requestRenderAll(),_(!0),n},eg=(e,t)=>{if(!e)return;let n=function(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=v.current;if(!o||!o.getContext||!o.getContext())return void(l<10?(console.warn("[DOBO] Canvas a\xfan inicializando (".concat(l+1,"/10)...")),setTimeout(()=>n(l+1),80)):console.error("[DOBO] Canvas no disponible tras varios intentos."));let i=new FileReader;i.onload=()=>{let e=i.result,n=new Image;n.crossOrigin="anonymous",n.onload=()=>{let e=function(e){let t=e.naturalWidth||e.width,n=e.naturalHeight||e.height,l=Math.min(1600/t,1600/n,1);if(!t||!n||1===l)return e;let o=Math.round(t*l),r=Math.round(n*l),i=document.createElement("canvas");i.width=o,i.height=r;let a=i.getContext("2d");return a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(e,0,0,o,r),i}(n);if("vector"===t){var l,i,a;let t=null!=(a=null==u?void 0:u(et))?a:{r:0,g:0,b:0},n=null==d?void 0:d(e,{maxDim:500,makeDark:!0,drawColor:t,thrBias:void 0!==el?el:0});if(!n)return;let r=.8*o.getWidth(),s=.8*o.getHeight(),c=Math.min(r/((null==(l=n._vecMeta)?void 0:l.w)||n.width||1),s/((null==(i=n._vecMeta)?void 0:i.h)||n.height||1),1);n.set({originX:"center",originY:"center",left:o.getWidth()/2,top:o.getHeight()/2,scaleX:c,scaleY:c,selectable:!0,evented:!0,objectCaching:!1}),o.add(n),o.setActiveObject(n),null==T||T("image"),null==_||_(!0),requestAnimationFrame(()=>{var e,t;null==(e=o.calcOffset)||e.call(o),null==(t=o.renderAll)||t.call(o)});return}let s=e&&(e instanceof HTMLCanvasElement||e instanceof HTMLImageElement)?e:n,c=new r.Image(s,{originX:"center",originY:"center",left:o.getWidth()/2,top:o.getHeight()/2,selectable:!0,evented:!0,objectCaching:!1});c._doboKind="camera"===t?"camera":"rgb";let p=.85*o.getWidth(),g=.85*o.getHeight(),h=Math.min(p/(s.naturalWidth||s.width||c.width||1),g/(s.naturalHeight||s.height||c.height||1),1);c.set({scaleX:h,scaleY:h}),o.add(c),o.setActiveObject(c),null==T||T("image"),null==_||_(!0),requestAnimationFrame(()=>{var e,t;null==(e=o.calcOffset)||e.call(o),null==(t=o.renderAll)||t.call(o)})},n.onerror=()=>console.error("[DOBO] Error cargando imagen"),n.src=e},i.readAsDataURL(e)};n()},eh=()=>{var e;let t=v.current;if(!t)return;let n=t.getActiveObject();if(!n)return;let l=e=>{if(e)try{t.remove(e)}catch(e){}};if("activeSelection"===n.type&&(null==(e=n._objects)?void 0:e.length)){let e=n._objects.slice();n.discard(),e.forEach(l)}else l(n);t.discardActiveObject(),t.requestRenderAll(),T("none")},ef=e=>{let t=v.current;if(!t)return;let n=t.getActiveObject();if(!n)return;let l=t=>{if(!t||"textGroup"!==t._kind)return;let{base:n,shadow:l,highlight:o}=t._textChildren||{};[n,l,o].forEach(t=>t&&e(t));let r=Math.max(1e-6,Math.abs(t.scaleX||1)),i=Math.max(1e-6,Math.abs(t.scaleY||1)),a=1/r,s=1/i;null==l||l.set({left:-a,top:-s}),null==o||o.set({left:+a,top:+s}),t.setCoords()};"activeSelection"===n.type&&Array.isArray(n._objects)?n._objects.forEach(l):"textGroup"===n._kind?l(n):("textbox"===n.type||"i-text"===n.type||"text"===n.type)&&e(n),t.requestRenderAll()};if((0,o.useEffect)(()=>{var e;if(!D||"image"!==M)return;let t=v.current;if(!t)return;let n=t.getActiveObject();if(!n)return;let l=e=>{if((null==e?void 0:e._doboKind)!=="vector")return;let n=e._vecSourceEl||("function"==typeof e.getElement?e.getElement():e._element);if(!n)return;let l={left:e.left,top:e.top,originX:e.originX,originY:e.originY,scaleX:e.scaleX,scaleY:e.scaleY,angle:e.angle||0};try{e.canvas.remove(e)}catch(e){}let o=d(n,{maxDim:500,makeDark:!0,drawColor:u(et),thrBias:el});o&&(o._doboKind="vector",o.set({selectable:!0,evented:!0,objectCaching:!1}),o.set(l),t.add(o),t.setActiveObject(o))};if("activeSelection"===n.type&&(null==(e=n._objects)?void 0:e.length)){let e=n._objects.slice();n.discard(),e.forEach(l)}else l(n);t.requestRenderAll()},[el]),(0,o.useEffect)(()=>{var e;let t=(null==n?void 0:n.current)||(null==(e=v.current)?void 0:e.upperCanvasEl);if(!t)return;let l=e=>{var t,l;if(Z)return;e.preventDefault();let o=c((parseFloat((null==n||null==(t=n.current)?void 0:t.style.getPropertyValue("--zoom"))||"1")||1)+(e.deltaY>0?-.08:.08),.6,2.5);null==n||null==(l=n.current)||l.style.setProperty("--zoom",String(o)),"function"==typeof m&&m(o)};return t.addEventListener("wheel",l,{passive:!1}),()=>t.removeEventListener("wheel",l)},[n,m,Z]),!h)return null;let em=(0,l.jsx)("div",{ref:x,style:{position:"absolute",left:N.left,top:N.top,width:N.w,height:N.h,zIndex:4e3,overflow:"hidden",pointerEvents:D?"auto":"none",touchAction:D?"none":"auto",overscrollBehavior:"contain"},onPointerDown:e=>{D&&e.stopPropagation()},children:(0,l.jsx)("canvas",{"data-dobo-design":"1",ref:b,width:N.w,height:N.h,style:{width:"100%",height:"100%",display:"block",background:"transparent",touchAction:D?"none":"auto"}})});return(0,l.jsxs)(l.Fragment,{children:[(null==n?void 0:n.current)?(0,i.createPortal)(em,n.current):null,(null==g?void 0:g.current)?(0,i.createPortal)((0,l.jsx)("div",{style:{position:"relative",width:"100%",display:"flex",justifyContent:"center",pointerEvents:"none",marginTop:8},children:(0,l.jsx)("div",{style:{pointerEvents:"auto",display:"inline-flex"},children:(0,l.jsx)(()=>{let e=v.current,t=null==e?void 0:e.getActiveObject(),n="image"===M&&t&&"vector"===t._doboKind,o="image"===M&&t&&"rgb"===t._doboKind;return(0,l.jsxs)("div",{ref:C,style:{display:"flex",flexDirection:"column",gap:8,background:"rgba(253, 253, 253, 0.34)",backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)",border:"1px solid #ddd",borderRadius:12,padding:"10px 12px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",width:"auto",maxWidth:"94vw",fontSize:12,userSelect:"none"},onPointerDown:e=>e.stopPropagation(),onPointerMove:e=>e.stopPropagation(),onPointerUp:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:10,alignItems:"center",flexWrap:"wrap"},children:[(0,l.jsxs)("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Historial",children:[(0,l.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>e.stopPropagation(),onMouseDown:e=>e.preventDefault(),onClick:()=>{var e;let t=null==(e=F.current)?void 0:e.undo();t&&es(t),ec()},disabled:!W.canUndo,title:"Atr\xe1s (Ctrl+Z)","aria-label":"Atr\xe1s",children:(0,l.jsx)("i",{className:"fa fa-undo","aria-hidden":"true"})}),(0,l.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>e.stopPropagation(),onMouseDown:e=>e.preventDefault(),onClick:()=>{var e;let t=null==(e=F.current)?void 0:e.redo();t&&es(t),ec()},disabled:!W.canRedo,title:"Adelante (Ctrl+Shift+Z)","aria-label":"Adelante",children:(0,l.jsx)("i",{className:"fa fa-repeat","aria-hidden":"true"})})]}),"function"==typeof m&&(0,l.jsxs)("div",{className:"input-group input-group-sm",style:{width:180},children:[(0,l.jsx)("span",{className:"input-group-text",children:"Zoom"}),(0,l.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>m(e=>Math.max(.8,+(e-.1).toFixed(2))),children:"−"}),(0,l.jsx)("input",{type:"text",readOnly:!0,className:"form-control form-control-sm text-center",value:"".concat(Math.round(100*(f||1)),"%")}),(0,l.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>m(e=>Math.min(2.5,+(e+.1).toFixed(2))),children:"+"})]}),(0,l.jsx)("button",{type:"button",className:"btn ".concat(D?"btn-outline-secondary":"btn-dark"," text-nowrap"),onMouseDown:e=>e.preventDefault(),onPointerDown:e=>e.stopPropagation(),onClick:()=>_(!1),style:{minWidth:"16ch"},children:"Seleccionar Maceta"}),(0,l.jsx)("button",{type:"button",className:"btn ".concat(D?"btn-dark":"btn-outline-secondary"," text-nowrap"),onMouseDown:e=>e.preventDefault(),onPointerDown:e=>e.stopPropagation(),onClick:()=>_(!0),style:{minWidth:"12ch"},children:"Dise\xf1ar"})]}),D&&(0,l.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",justifyContent:"center"},children:[(0,l.jsxs)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onPointerDown:e=>e.stopPropagation(),onClick:ep,disabled:!O,title:"Agregar texto",children:[(0,l.jsx)("i",{className:"fa fa-font","aria-hidden":"true"})," Texto"]}),(0,l.jsxs)("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Cargas",children:[(0,l.jsxs)("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>e.stopPropagation(),onClick:()=>{A("vector"),requestAnimationFrame(()=>{var e;null==(e=y.current)||e.click()})},disabled:!O,title:"Subir vector (usa Detalles y Color)",children:[(0,l.jsx)("i",{className:"fa fa-magic","aria-hidden":"true"})," Vector"]}),(0,l.jsxs)("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>e.stopPropagation(),onClick:()=>{A("rgb"),requestAnimationFrame(()=>{var e;null==(e=j.current)||e.click()})},disabled:!O,title:"Subir imagen RGB (color original)",children:[(0,l.jsx)("i",{className:"fa fa-image","aria-hidden":"true"})," Imagen"]}),(0,l.jsxs)("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>e.stopPropagation(),onClick:()=>{A("rgb"),requestAnimationFrame(()=>{var e;null==(e=w.current)||e.click()})},disabled:!O,title:"Tomar foto con c\xe1mara",children:[(0,l.jsx)("i",{className:"fa fa-camera","aria-hidden":"true"})," C\xe1mara"]})]}),(0,l.jsxs)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onPointerDown:e=>e.stopPropagation(),onClick:eh,disabled:!O||"none"===M,title:"Eliminar seleccionado",children:[(0,l.jsx)("i",{className:"fa fa-trash","aria-hidden":"true"})," Borrar"]})]}),D&&(0,l.jsxs)(l.Fragment,{children:["text"===M&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"input-group input-group-sm",style:{maxWidth:220,marginBottom:6},children:[(0,l.jsx)("span",{className:"input-group-text",children:"Color"}),(0,l.jsx)("input",{type:"color",className:"form-control form-control-color",value:et,onChange:e=>{en(e.target.value),ef(t=>t.set({fill:"rgba(".concat(u(e.target.value).join(","),",1)")}))},onPointerDown:e=>e.stopPropagation()})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap",justifyContent:"center"},children:[(0,l.jsxs)("div",{className:"input-group input-group-sm",style:{maxWidth:240},children:[(0,l.jsx)("span",{className:"input-group-text",children:"Fuente"}),(0,l.jsx)("select",{className:"form-select form-select-sm",value:X,onChange:e=>{let t=e.target.value;q(t),ef(e=>e.set({fontFamily:t}))},onPointerDown:e=>e.stopPropagation(),children:s.map(e=>(0,l.jsx)("option",{value:e.css,style:{fontFamily:e.css},children:e.name},e.name))})]}),(0,l.jsxs)("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Estilos",children:[(0,l.jsx)("button",{type:"button",className:"btn ".concat(B?"btn-dark":"btn-outline-secondary"),onPointerDown:e=>e.stopPropagation(),onClick:()=>{let e=!B;z(e),ef(t=>t.set({fontWeight:e?"700":"normal"}))},title:"Negrita",children:"B"}),(0,l.jsx)("button",{type:"button",className:"btn ".concat(H?"btn-dark":"btn-outline-secondary"),onPointerDown:e=>e.stopPropagation(),onClick:()=>{let e=!H;L(e),ef(t=>t.set({fontStyle:e?"italic":"normal"}))},title:"Cursiva",children:"I"}),(0,l.jsx)("button",{type:"button",className:"btn ".concat(U?"btn-dark":"btn-outline-secondary"),onPointerDown:e=>e.stopPropagation(),onClick:()=>{let e=!U;K(e),ef(t=>t.set({underline:e}))},title:"Subrayado",children:"U"})]}),(0,l.jsxs)("div",{className:"input-group input-group-sm",style:{width:160},children:[(0,l.jsx)("span",{className:"input-group-text",children:"Tama\xf1o"}),(0,l.jsx)("input",{type:"number",className:"form-control form-control-sm",min:8,max:200,step:1,value:I,onPointerDown:e=>e.stopPropagation(),onChange:e=>{let t=c(parseInt(e.target.value||"0",10),8,200);G(t),ef(e=>e.set({fontSize:t}))}})]}),(0,l.jsxs)("div",{className:"btn-group dropup",children:[(0,l.jsx)("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onPointerDown:e=>e.stopPropagation(),onClick:()=>ee(e=>!e),title:"Alineaci\xf3n",children:"left"===J?"⟸":"center"===J?"⟺":"right"===J?"⟹":"≣"}),$&&(0,l.jsx)("ul",{className:"dropdown-menu show",style:{position:"absolute"},children:["left","center","right","justify"].map(e=>(0,l.jsx)("li",{children:(0,l.jsx)("button",{type:"button",className:"dropdown-item ".concat(J===e?"active":""),onPointerDown:e=>e.stopPropagation(),onClick:()=>{V(e),ee(!1),ef(t=>t.set({textAlign:e}))},children:e})},e))})]})]})]}),"image"===M&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"input-group input-group-sm",style:{maxWidth:220,marginBottom:6},children:[(0,l.jsx)("span",{className:"input-group-text",children:"Color"}),(0,l.jsx)("input",{type:"color",className:"form-control form-control-color",value:et,onChange:e=>{en(e.target.value),n&&(e=>{var t;let n=v.current;if(!n)return;let l=n.getActiveObject();if(!l)return;let o=u(e),r=e=>{let t=null,l=null;if((null==e?void 0:e._doboKind)!=="vector")return;{let n=e._vecSourceEl||("function"==typeof e.getElement?e.getElement():e._element);if(!n)return;t=n,l={left:e.left,top:e.top,originX:e.originX,originY:e.originY,scaleX:e.scaleX,scaleY:e.scaleY,angle:e.angle||0};try{e.canvas.remove(e)}catch(e){}}let r=d(t,{maxDim:500,makeDark:!0,drawColor:o,thrBias:el});r&&(r._doboKind="vector",r.set({selectable:!0,evented:!0,objectCaching:!1}),r.set(l),n.add(r),n.setActiveObject(r))};if("activeSelection"===l.type&&(null==(t=l._objects)?void 0:t.length)){let e=l._objects.slice();l.discard(),e.forEach(r)}else"vector"===l._doboKind?r(l):("textGroup"===l._kind||"textbox"===l.type||"i-text"===l.type||"text"===l.type)&&ef(e=>e.set({fill:"rgba(".concat(o.join(","),",1)")}));n.requestRenderAll()})(e.target.value)},onPointerDown:e=>e.stopPropagation(),disabled:!n,title:n?"Color del vector":"Solo para vectores"})]}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,justifyContent:"center",flexWrap:"wrap"},children:[(0,l.jsxs)("div",{className:"input-group input-group-sm",style:{width:230},children:[(0,l.jsx)("span",{className:"input-group-text",children:"Detalles"}),(0,l.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>e.stopPropagation(),onClick:()=>eo(e=>c(e-5,-60,60)),disabled:!n,children:"−"}),(0,l.jsx)("input",{type:"text",readOnly:!0,className:"form-control form-control-sm text-center",value:el}),(0,l.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:e=>e.stopPropagation(),onClick:()=>eo(e=>c(e+5,-60,60)),disabled:!n,children:"+"})]}),o&&(0,l.jsx)("span",{className:"badge bg-secondary",title:"Imagen RGB (no afecta Color ni Detalles)",children:"RGB"})]})]})]}),(0,l.jsx)("input",{ref:y,type:"file",accept:"image/*",style:{display:"none"},onChange:e=>{var t;let n=null==(t=e.target.files)?void 0:t[0];n&&eg(n,"vector"),e.target.value=null},onPointerDown:e=>e.stopPropagation()}),(0,l.jsx)("input",{ref:j,type:"file",accept:"image/*",style:{display:"none"},onChange:e=>{var t;let n=null==(t=e.target.files)?void 0:t[0];n&&eg(n,"rgb"),e.target.value=null},onPointerDown:e=>e.stopPropagation()}),(0,l.jsx)("input",{ref:w,id:"cameraInput",type:"file",accept:"image/*",capture:"environment",style:{display:"none"},onChange:e=>{var t;let n=null==(t=e.target.files)?void 0:t[0];n&&eg(n,"camera"),e.target.value=null},onPointerDown:e=>e.stopPropagation()})]})},{})})}),document.getElementById("dobo-menu-dock")||document.body):null]})}}}]);