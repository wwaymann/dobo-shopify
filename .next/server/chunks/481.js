"use strict";exports.id=481,exports.ids=[481],exports.modules={4481:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>l});var e=c(8732),f=c(2015),g=c(2079),h=c(2326);c(5523);var i=a([g]);g=(i.then?(await i)():i)[0];let m=[{name:"Arial",css:"Arial, Helvetica, sans-serif"},{name:"Georgia",css:"Georgia, serif"},{name:"Times New Roman",css:'"Times New Roman", Times, serif'},{name:"Courier New",css:'"Courier New", Courier, monospace'},{name:"Trebuchet MS",css:'"Trebuchet MS", Tahoma, sans-serif'},{name:"Montserrat",css:"Montserrat, Arial, sans-serif"},{name:"Poppins",css:"Poppins, Arial, sans-serif"}],n=(a,b,c)=>Math.max(b,Math.min(c,a));function j(a){let b=String(a||"").replace("#","").match(/^([0-9a-f]{3}|[0-9a-f]{6})$/i);if(!b)return[51,51,51];let c=b[1];3===c.length&&(c=c.split("").map(a=>a+a).join(""));let d=parseInt(c,16);return[d>>16&255,d>>8&255,255&d]}function k(a,b={}){let c,{maxDim:d=500,makeDark:e=!0,drawColor:f=[51,51,51],thrBias:h=0}=b,i=a?.width,j=a?.height;if(!i||!j)return null;let l=i>j?d/i:d/j,m=Math.max(1,Math.round(i*l)),o=Math.max(1,Math.round(j*l)),p=document.createElement("canvas");p.width=m,p.height=o;let q=p.getContext("2d",{willReadFrequently:!0});q.imageSmoothingEnabled=!0,q.imageSmoothingQuality="high",q.drawImage(a,0,0,m,o);try{c=q.getImageData(0,0,m,o)}catch{return null}let r=c?.data,s=m*o;if(!r||r.length<4*s)return null;let t=new Uint8Array(s);for(let a=0,b=0;b<s;a+=4,b++){let c=r[a],d=r[a+1],e=r[a+2];t[b]=Math.round(.299*c+.587*d+.114*e)}let u=function(a,b){if(!a||!b||b<=0)return 127;let c=new Uint32Array(256);for(let d=0;d<b;d++)c[a[d]]++;let d=0;for(let a=0;a<256;a++)d+=a*c[a];let e=0,f=0,g=-1,h=127;for(let a=0;a<256;a++){if(f+=c[a],0===f)continue;let i=b-f;if(0===i)break;let j=(e+=a*c[a])/f,k=(d-e)/i,l=j-k,m=f*i*l*l;Number.isFinite(m)&&m>g&&(g=m,h=a)}return h}(t,s),v=n(u+h,0,255);for(let a=0,b=0;a<s;a++,b+=4)(e?t[a]<=v:t[a]>v)?(r[b]=f[0],r[b+1]=f[1],r[b+2]=f[2],r[b+3]=255):r[b+3]=0;q.putImageData(c,0,0);let w=new g.Image(p,{left:0,top:0,originX:"left",originY:"top",objectCaching:!1,noScaleCache:!0,selectable:!0,evented:!0});return w._vecSourceEl=a,w._vecMeta={w:m,h:o},w._doboKind="vector",w}function l({stageRef:a,anchorRef:b,visible:c=!0,zoom:d=.6,setZoom:i}){let l,o=(0,f.useRef)(null),p=(0,f.useRef)(null),q=(0,f.useRef)(null),r=(0,f.useRef)(null),s=(0,f.useRef)(null),t=(0,f.useRef)(null),u=(0,f.useRef)(null),[v,w]=(0,f.useState)(null),[x,y]=(0,f.useState)({w:1,h:1}),[z,A]=(0,f.useState)({left:0,top:0,w:1,h:1}),[B,C]=(0,f.useState)(!1),[D,E]=(0,f.useState)(!1),[F,G]=(0,f.useState)("none"),H=(0,f.useRef)(null),[I,J]=(0,f.useState)({canUndo:!1,canRedo:!1}),[K,L]=(0,f.useState)(m[0].css),[M,N]=(0,f.useState)(60),[O,P]=(0,f.useState)(!1),[Q,R]=(0,f.useState)(!1),[S,T]=(0,f.useState)(!1),[U,V]=(0,f.useState)("center"),[W,X]=(0,f.useState)(!1),[Y,Z]=(0,f.useState)(!1),[$,_]=(0,f.useState)("#333333"),[aa,ab]=(0,f.useState)(0);(0,f.useRef)(!1),(0,f.useRef)(null);let ac=a=>{let b=p.current;b&&a&&(b._skipHistory=!0,b.loadFromJSON(a,()=>{b._skipHistory=!1,b.requestRenderAll()}))},ad=()=>J({canUndo:!!H.current?.canUndo(),canRedo:!!H.current?.canRedo()});l=null,()=>{p.current?._skipHistory||(clearTimeout(l),l=setTimeout(()=>{let a=(()=>{let a=p.current;return a?a.toJSON(["_kind","_textChildren","_vecSourceEl","_vecMeta","_doboKind"]):null})();a&&H.current&&H.current.push(a),ad()},140))};let ae=()=>{let a=p.current;if(!a)return;let b=function(a,b={}){let c=new g.Textbox(a,{...b,originX:"center",originY:"center",selectable:!0,evented:!0,objectCaching:!1,fill:b.fill??"rgba(35,35,35,1)"}),d=new g.Textbox(a,{...b,originX:"center",originY:"center",left:-1,top:-1,selectable:!1,evented:!1,objectCaching:!1,fill:"",stroke:"rgba(0,0,0,0.25)",strokeWidth:.8}),e=new g.Textbox(a,{...b,originX:"center",originY:"center",left:1,top:1,selectable:!1,evented:!1,objectCaching:!1,fill:"",stroke:"rgba(255,255,255,0.45)",strokeWidth:.5}),f=new g.Group([d,e,c],{originX:"center",originY:"center",subTargetCheck:!1,objectCaching:!1,selectable:!0,evented:!0,scaleX:1,scaleY:1});f._kind="textGroup",f._textChildren={base:c,shadow:d,highlight:e};let h=()=>{let a=Math.max(1e-6,Math.abs(f.scaleX||1)),b=Math.max(1e-6,Math.abs(f.scaleY||1)),c=1/a,g=1/b;d.set({left:-c,top:-g}),e.set({left:+c,top:+g}),f.setCoords(),f.canvas?.requestRenderAll?.()};return f.on("scaling",h),f.on("modified",h),h(),f}("Nuevo texto",{width:Math.min(.9*x.w,240),fontSize:M,fontFamily:K,fontWeight:O?"700":"normal",fontStyle:Q?"italic":"normal",underline:S,textAlign:U,fill:`rgba(${j($).join(",")},1)`});b.set({left:x.w/2,top:x.h/2,originX:"center",originY:"center"});let c=a.add(b);return a.setActiveObject(b),G("text"),a.requestRenderAll(),C(!0),c},af=(a,b)=>{if(!a)return;let c=(d=0)=>{let e=p.current;if(!e||!e.getContext||!e.getContext())return void(d<10?(console.warn(`[DOBO] Canvas a\xfan inicializando (${d+1}/10)...`),setTimeout(()=>c(d+1),80)):console.error("[DOBO] Canvas no disponible tras varios intentos."));let f=new FileReader;f.onload=()=>{let a=f.result,c=new Image;c.crossOrigin="anonymous",c.onload=()=>{let a=function(a){let b=a.naturalWidth||a.width,c=a.naturalHeight||a.height,d=Math.min(1600/b,1600/c,1);if(!b||!c||1===d)return a;let e=Math.round(b*d),f=Math.round(c*d),g=document.createElement("canvas");g.width=e,g.height=f;let h=g.getContext("2d");return h.imageSmoothingEnabled=!0,h.imageSmoothingQuality="high",h.drawImage(a,0,0,e,f),g}(c);if("vector"===b){let b=j?.($)??{r:0,g:0,b:0},c=k?.(a,{maxDim:500,makeDark:!0,drawColor:b,thrBias:void 0!==aa?aa:0});if(!c)return;let d=.8*e.getWidth(),f=.8*e.getHeight(),g=c._vecMeta?.w||c.width||1,h=c._vecMeta?.h||c.height||1,i=Math.min(d/g,f/h,1);c.set({originX:"center",originY:"center",left:e.getWidth()/2,top:e.getHeight()/2,scaleX:i,scaleY:i,selectable:!0,evented:!0,objectCaching:!1}),e.add(c),e.setActiveObject(c),G?.("image"),C?.(!0),requestAnimationFrame(()=>{e.calcOffset?.(),e.renderAll?.()});return}let d=a&&(a instanceof HTMLCanvasElement||a instanceof HTMLImageElement)?a:c,f=new g.Image(d,{originX:"center",originY:"center",left:e.getWidth()/2,top:e.getHeight()/2,selectable:!0,evented:!0,objectCaching:!1});f._doboKind="camera"===b?"camera":"rgb";let h=.85*e.getWidth(),i=.85*e.getHeight(),l=d.naturalWidth||d.width||f.width||1,m=d.naturalHeight||d.height||f.height||1,n=Math.min(h/l,i/m,1);f.set({scaleX:n,scaleY:n}),e.add(f),e.setActiveObject(f),G?.("image"),C?.(!0),requestAnimationFrame(()=>{e.calcOffset?.(),e.renderAll?.()})},c.onerror=()=>console.error("[DOBO] Error cargando imagen"),c.src=a},f.readAsDataURL(a)};c()},ag=()=>{let a=p.current;if(!a)return;let b=a.getActiveObject();if(!b)return;let c=b=>{if(b)try{a.remove(b)}catch{}};if("activeSelection"===b.type&&b._objects?.length){let a=b._objects.slice();b.discard(),a.forEach(c)}else c(b);a.discardActiveObject(),a.requestRenderAll(),G("none")},ah=a=>{let b=p.current;if(!b)return;let c=b.getActiveObject();if(!c)return;let d=b=>{if(!b||"textGroup"!==b._kind)return;let{base:c,shadow:d,highlight:e}=b._textChildren||{};[c,d,e].forEach(b=>b&&a(b));let f=Math.max(1e-6,Math.abs(b.scaleX||1)),g=Math.max(1e-6,Math.abs(b.scaleY||1)),h=1/f,i=1/g;d?.set({left:-h,top:-i}),e?.set({left:+h,top:+i}),b.setCoords()};"activeSelection"===c.type&&Array.isArray(c._objects)?c._objects.forEach(d):"textGroup"===c._kind?d(c):("textbox"===c.type||"i-text"===c.type||"text"===c.type)&&a(c),b.requestRenderAll()};if(!c)return null;let ai=(0,e.jsx)("div",{ref:q,style:{position:"absolute",left:z.left,top:z.top,width:z.w,height:z.h,zIndex:4e3,overflow:"hidden",pointerEvents:B?"auto":"none",touchAction:B?"none":"auto",overscrollBehavior:"contain"},onPointerDown:a=>{B&&a.stopPropagation()},children:(0,e.jsx)("canvas",{"data-dobo-design":"1",ref:o,width:z.w,height:z.h,style:{width:"100%",height:"100%",display:"block",background:"transparent",touchAction:B?"none":"auto"}})});return(0,e.jsxs)(e.Fragment,{children:[a?.current?(0,h.createPortal)(ai,a.current):null,b?.current?(0,h.createPortal)((0,e.jsx)("div",{style:{position:"relative",width:"100%",display:"flex",justifyContent:"center",pointerEvents:"none",marginTop:8},children:(0,e.jsx)("div",{style:{pointerEvents:"auto",display:"inline-flex"},children:(0,e.jsx)(()=>{let a=p.current,b=a?.getActiveObject(),c="image"===F&&b&&"vector"===b._doboKind,f="image"===F&&b&&"rgb"===b._doboKind;return(0,e.jsxs)("div",{ref:u,style:{display:"flex",flexDirection:"column",gap:8,background:"rgba(253, 253, 253, 0.34)",backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)",border:"1px solid #ddd",borderRadius:12,padding:"10px 12px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",width:"auto",maxWidth:"94vw",fontSize:12,userSelect:"none"},onPointerDown:a=>a.stopPropagation(),onPointerMove:a=>a.stopPropagation(),onPointerUp:a=>a.stopPropagation(),children:[(0,e.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:10,alignItems:"center",flexWrap:"wrap"},children:[(0,e.jsxs)("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Historial",children:[(0,e.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:a=>a.stopPropagation(),onMouseDown:a=>a.preventDefault(),onClick:()=>{let a=H.current?.undo();a&&ac(a),ad()},disabled:!I.canUndo,title:"Atr\xe1s (Ctrl+Z)","aria-label":"Atr\xe1s",children:(0,e.jsx)("i",{className:"fa fa-undo","aria-hidden":"true"})}),(0,e.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:a=>a.stopPropagation(),onMouseDown:a=>a.preventDefault(),onClick:()=>{let a=H.current?.redo();a&&ac(a),ad()},disabled:!I.canRedo,title:"Adelante (Ctrl+Shift+Z)","aria-label":"Adelante",children:(0,e.jsx)("i",{className:"fa fa-repeat","aria-hidden":"true"})})]}),"function"==typeof i&&(0,e.jsxs)("div",{className:"input-group input-group-sm",style:{width:180},children:[(0,e.jsx)("span",{className:"input-group-text",children:"Zoom"}),(0,e.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>i(a=>Math.max(.8,+(a-.1).toFixed(2))),children:"−"}),(0,e.jsx)("input",{type:"text",readOnly:!0,className:"form-control form-control-sm text-center",value:`${Math.round(100*(d||1))}%`}),(0,e.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>i(a=>Math.min(2.5,+(a+.1).toFixed(2))),children:"+"})]}),(0,e.jsx)("button",{type:"button",className:`btn ${!B?"btn-dark":"btn-outline-secondary"} text-nowrap`,onMouseDown:a=>a.preventDefault(),onPointerDown:a=>a.stopPropagation(),onClick:()=>C(!1),style:{minWidth:"16ch"},children:"Seleccionar Maceta"}),(0,e.jsx)("button",{type:"button",className:`btn ${B?"btn-dark":"btn-outline-secondary"} text-nowrap`,onMouseDown:a=>a.preventDefault(),onPointerDown:a=>a.stopPropagation(),onClick:()=>C(!0),style:{minWidth:"12ch"},children:"Dise\xf1ar"})]}),B&&(0,e.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",justifyContent:"center"},children:[(0,e.jsxs)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onPointerDown:a=>a.stopPropagation(),onClick:ae,disabled:!D,title:"Agregar texto",children:[(0,e.jsx)("i",{className:"fa fa-font","aria-hidden":"true"})," Texto"]}),(0,e.jsxs)("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Cargas",children:[(0,e.jsxs)("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:a=>a.stopPropagation(),onClick:()=>{w("vector"),requestAnimationFrame(()=>{r.current?.click()})},disabled:!D,title:"Subir vector (usa Detalles y Color)",children:[(0,e.jsx)("i",{className:"fa fa-magic","aria-hidden":"true"})," Vector"]}),(0,e.jsxs)("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:a=>a.stopPropagation(),onClick:()=>{w("rgb"),requestAnimationFrame(()=>{s.current?.click()})},disabled:!D,title:"Subir imagen RGB (color original)",children:[(0,e.jsx)("i",{className:"fa fa-image","aria-hidden":"true"})," Imagen"]}),(0,e.jsxs)("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:a=>a.stopPropagation(),onClick:()=>{w("rgb"),requestAnimationFrame(()=>{t.current?.click()})},disabled:!D,title:"Tomar foto con c\xe1mara",children:[(0,e.jsx)("i",{className:"fa fa-camera","aria-hidden":"true"})," C\xe1mara"]})]}),(0,e.jsxs)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onPointerDown:a=>a.stopPropagation(),onClick:ag,disabled:!D||"none"===F,title:"Eliminar seleccionado",children:[(0,e.jsx)("i",{className:"fa fa-trash","aria-hidden":"true"})," Borrar"]})]}),B&&(0,e.jsxs)(e.Fragment,{children:["text"===F&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"input-group input-group-sm",style:{maxWidth:220,marginBottom:6},children:[(0,e.jsx)("span",{className:"input-group-text",children:"Color"}),(0,e.jsx)("input",{type:"color",className:"form-control form-control-color",value:$,onChange:a=>{_(a.target.value),ah(b=>b.set({fill:`rgba(${j(a.target.value).join(",")},1)`}))},onPointerDown:a=>a.stopPropagation()})]}),(0,e.jsxs)("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap",justifyContent:"center"},children:[(0,e.jsxs)("div",{className:"input-group input-group-sm",style:{maxWidth:240},children:[(0,e.jsx)("span",{className:"input-group-text",children:"Fuente"}),(0,e.jsx)("select",{className:"form-select form-select-sm",value:K,onChange:a=>{let b=a.target.value;L(b),ah(a=>a.set({fontFamily:b}))},onPointerDown:a=>a.stopPropagation(),children:m.map(a=>(0,e.jsx)("option",{value:a.css,style:{fontFamily:a.css},children:a.name},a.name))})]}),(0,e.jsxs)("div",{className:"btn-group btn-group-sm",role:"group","aria-label":"Estilos",children:[(0,e.jsx)("button",{type:"button",className:`btn ${O?"btn-dark":"btn-outline-secondary"}`,onPointerDown:a=>a.stopPropagation(),onClick:()=>{let a=!O;P(a),ah(b=>b.set({fontWeight:a?"700":"normal"}))},title:"Negrita",children:"B"}),(0,e.jsx)("button",{type:"button",className:`btn ${Q?"btn-dark":"btn-outline-secondary"}`,onPointerDown:a=>a.stopPropagation(),onClick:()=>{let a=!Q;R(a),ah(b=>b.set({fontStyle:a?"italic":"normal"}))},title:"Cursiva",children:"I"}),(0,e.jsx)("button",{type:"button",className:`btn ${S?"btn-dark":"btn-outline-secondary"}`,onPointerDown:a=>a.stopPropagation(),onClick:()=>{let a=!S;T(a),ah(b=>b.set({underline:a}))},title:"Subrayado",children:"U"})]}),(0,e.jsxs)("div",{className:"input-group input-group-sm",style:{width:160},children:[(0,e.jsx)("span",{className:"input-group-text",children:"Tama\xf1o"}),(0,e.jsx)("input",{type:"number",className:"form-control form-control-sm",min:8,max:200,step:1,value:M,onPointerDown:a=>a.stopPropagation(),onChange:a=>{let b=n(parseInt(a.target.value||"0",10),8,200);N(b),ah(a=>a.set({fontSize:b}))}})]}),(0,e.jsxs)("div",{className:"btn-group dropup",children:[(0,e.jsx)("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onPointerDown:a=>a.stopPropagation(),onClick:()=>Z(a=>!a),title:"Alineaci\xf3n",children:"left"===U?"⟸":"center"===U?"⟺":"right"===U?"⟹":"≣"}),Y&&(0,e.jsx)("ul",{className:"dropdown-menu show",style:{position:"absolute"},children:["left","center","right","justify"].map(a=>(0,e.jsx)("li",{children:(0,e.jsx)("button",{type:"button",className:`dropdown-item ${U===a?"active":""}`,onPointerDown:a=>a.stopPropagation(),onClick:()=>{V(a),Z(!1),ah(b=>b.set({textAlign:a}))},children:a})},a))})]})]})]}),"image"===F&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"input-group input-group-sm",style:{maxWidth:220,marginBottom:6},children:[(0,e.jsx)("span",{className:"input-group-text",children:"Color"}),(0,e.jsx)("input",{type:"color",className:"form-control form-control-color",value:$,onChange:a=>{_(a.target.value),c&&(a=>{let b=p.current;if(!b)return;let c=b.getActiveObject();if(!c)return;let d=j(a),e=a=>{let c=null,e=null;if(a?._doboKind!=="vector")return;{let b=a._vecSourceEl||("function"==typeof a.getElement?a.getElement():a._element);if(!b)return;c=b,e={left:a.left,top:a.top,originX:a.originX,originY:a.originY,scaleX:a.scaleX,scaleY:a.scaleY,angle:a.angle||0};try{a.canvas.remove(a)}catch{}}let f=k(c,{maxDim:500,makeDark:!0,drawColor:d,thrBias:aa});f&&(f._doboKind="vector",f.set({selectable:!0,evented:!0,objectCaching:!1}),f.set(e),b.add(f),b.setActiveObject(f))};if("activeSelection"===c.type&&c._objects?.length){let a=c._objects.slice();c.discard(),a.forEach(e)}else"vector"===c._doboKind?e(c):("textGroup"===c._kind||"textbox"===c.type||"i-text"===c.type||"text"===c.type)&&ah(a=>a.set({fill:`rgba(${d.join(",")},1)`}));b.requestRenderAll()})(a.target.value)},onPointerDown:a=>a.stopPropagation(),disabled:!c,title:c?"Color del vector":"Solo para vectores"})]}),(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,justifyContent:"center",flexWrap:"wrap"},children:[(0,e.jsxs)("div",{className:"input-group input-group-sm",style:{width:230},children:[(0,e.jsx)("span",{className:"input-group-text",children:"Detalles"}),(0,e.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:a=>a.stopPropagation(),onClick:()=>ab(a=>n(a-5,-60,60)),disabled:!c,children:"−"}),(0,e.jsx)("input",{type:"text",readOnly:!0,className:"form-control form-control-sm text-center",value:aa}),(0,e.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onPointerDown:a=>a.stopPropagation(),onClick:()=>ab(a=>n(a+5,-60,60)),disabled:!c,children:"+"})]}),f&&(0,e.jsx)("span",{className:"badge bg-secondary",title:"Imagen RGB (no afecta Color ni Detalles)",children:"RGB"})]})]})]}),(0,e.jsx)("input",{ref:r,type:"file",accept:"image/*",style:{display:"none"},onChange:a=>{let b=a.target.files?.[0];b&&af(b,"vector"),a.target.value=null},onPointerDown:a=>a.stopPropagation()}),(0,e.jsx)("input",{ref:s,type:"file",accept:"image/*",style:{display:"none"},onChange:a=>{let b=a.target.files?.[0];b&&af(b,"rgb"),a.target.value=null},onPointerDown:a=>a.stopPropagation()}),(0,e.jsx)("input",{ref:t,id:"cameraInput",type:"file",accept:"image/*",capture:"environment",style:{display:"none"},onChange:a=>{let b=a.target.files?.[0];b&&af(b,"camera"),a.target.value=null},onPointerDown:a=>a.stopPropagation()})]})},{})})}),document.getElementById("dobo-menu-dock")||document.body):null]})}d()}catch(a){d(a)}})},5523:(a,b,c)=>{c.d(b,{A:()=>d});class d{constructor({limit:a=200,onChange:b}={}){this.stack=[],this.index=-1,this.limit=a,this.onChange=b}push(a){this.stack=this.stack.slice(0,this.index+1),this.stack.push(a),this.stack.length>this.limit&&this.stack.shift(),this.index=this.stack.length-1,this.onChange?.(this.stack[this.index])}undo(){if(!this.canUndo())return null;this.index-=1;let a=this.stack[this.index];return this.onChange?.(a),a}redo(){if(!this.canRedo())return null;this.index+=1;let a=this.stack[this.index];return this.onChange?.(a),a}canUndo(){return this.index>0}canRedo(){return this.index>=0&&this.index<this.stack.length-1}}}};